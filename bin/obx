#!/usr/bin/env python3
# This file is place in the Public Domain.
# pylint: disable=C


"cli"


import os
import sys


sys.path.insert(0, os.getcwd())


from obx.main    import Client, Config, Event, scanner, command, parse, wrap
from obx.persist import Workdir
from obx.runtime import Errors


cfg = Config()


sys.path.insert(0, Workdir.wdr)


try:
    from mods import face
except ModuleNotFoundError:
    face = None


class CLI(Client):

    def raw(self, txt):
        print(txt)


def errors():
    for error in Errors.errors:
        for line in error:
            print(line)


def wrapped():
    wrap(main)
    if "v" in cfg.opts:
        errors()


def main():
    parse(cfg, " ".join(sys.argv[1:]))
    if face:
        scanner(face)
        evt = Event()
        evt.txt = cfg.txt
        csl = CLI()
        command(csl, evt)
        evt.wait()
    else:
        print(f"no modules in {Workdir.wdr}")


if __name__ == "__main__":
    wrapped()
